{
  "openapi": "3.0.0",
  "info": {
    "title": "Firebase Authentication API",
    "version": "1.0.0",
    "description": "Firebase Auth API specification for token verification (Backend use via firebase-admin SDK)"
  },
  "servers": [
    {
      "url": "https://identitytoolkit.googleapis.com/v1",
      "description": "Firebase Identity Toolkit API"
    }
  ],
  "components": {
    "securitySchemes": {
      "ServiceAccount": {
        "type": "apiKey",
        "in": "header",
        "name": "Authorization",
        "description": "Service account credentials for Firebase Admin SDK"
      }
    },
    "schemas": {
      "DecodedIdToken": {
        "type": "object",
        "description": "Decoded Firebase ID Token",
        "properties": {
          "uid": {
            "type": "string",
            "description": "User's unique identifier"
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "User's email address"
          },
          "email_verified": {
            "type": "boolean",
            "description": "Whether the email is verified"
          },
          "name": {
            "type": "string",
            "description": "User's display name"
          },
          "picture": {
            "type": "string",
            "format": "uri",
            "description": "User's profile picture URL"
          },
          "iss": {
            "type": "string",
            "description": "Token issuer (https://securetoken.google.com/<project-id>)"
          },
          "aud": {
            "type": "string",
            "description": "Token audience (Firebase project ID)"
          },
          "auth_time": {
            "type": "integer",
            "description": "Time when the user authenticated (Unix timestamp)"
          },
          "iat": {
            "type": "integer",
            "description": "Token issued at time (Unix timestamp)"
          },
          "exp": {
            "type": "integer",
            "description": "Token expiration time (Unix timestamp)"
          },
          "firebase": {
            "type": "object",
            "properties": {
              "sign_in_provider": {
                "type": "string",
                "enum": ["google.com", "apple.com", "password", "phone"],
                "description": "The sign-in provider used"
              },
              "identities": {
                "type": "object",
                "description": "Provider-specific identity information"
              }
            }
          }
        },
        "required": ["uid", "iss", "aud", "iat", "exp"]
      },
      "UserRecord": {
        "type": "object",
        "description": "Firebase User Record",
        "properties": {
          "uid": {
            "type": "string"
          },
          "email": {
            "type": "string",
            "format": "email"
          },
          "email_verified": {
            "type": "boolean"
          },
          "display_name": {
            "type": "string"
          },
          "photo_url": {
            "type": "string",
            "format": "uri"
          },
          "disabled": {
            "type": "boolean"
          },
          "provider_data": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "provider_id": {
                  "type": "string",
                  "enum": ["google.com", "apple.com"]
                },
                "uid": {
                  "type": "string"
                },
                "email": {
                  "type": "string"
                },
                "display_name": {
                  "type": "string"
                },
                "photo_url": {
                  "type": "string"
                }
              }
            }
          },
          "custom_claims": {
            "type": "object",
            "additionalProperties": true
          },
          "tokens_valid_after_time": {
            "type": "string",
            "format": "date-time"
          }
        }
      }
    }
  },
  "x-python-sdk": {
    "package": "firebase-admin",
    "version": ">=6.0.0",
    "installation": "uv add firebase-admin",
    "initialization": {
      "description": "Initialize Firebase Admin SDK",
      "code": "import firebase_admin\nfrom firebase_admin import credentials, auth\n\ncred = credentials.Certificate('path/to/serviceAccountKey.json')\nfirebase_admin.initialize_app(cred)"
    },
    "methods": {
      "verify_id_token": {
        "description": "Verify Firebase ID token from client",
        "signature": "auth.verify_id_token(id_token: str, check_revoked: bool = False) -> dict",
        "returns": "DecodedIdToken",
        "example": "decoded_token = auth.verify_id_token(id_token)\nuid = decoded_token['uid']"
      },
      "get_user": {
        "description": "Get user record by UID",
        "signature": "auth.get_user(uid: str) -> UserRecord",
        "example": "user = auth.get_user(uid)\nprint(user.email)"
      },
      "get_user_by_email": {
        "description": "Get user record by email",
        "signature": "auth.get_user_by_email(email: str) -> UserRecord",
        "example": "user = auth.get_user_by_email('user@example.com')"
      },
      "revoke_refresh_tokens": {
        "description": "Revoke all refresh tokens for a user",
        "signature": "auth.revoke_refresh_tokens(uid: str) -> None",
        "example": "auth.revoke_refresh_tokens(uid)"
      }
    }
  },
  "x-fastapi-integration": {
    "dependency_example": "from fastapi import Depends, HTTPException, status\nfrom fastapi.security import HTTPBearer, HTTPAuthorizationCredentials\nfrom firebase_admin import auth\n\nsecurity = HTTPBearer()\n\nasync def get_current_user(\n    credentials: HTTPAuthorizationCredentials = Depends(security)\n) -> dict:\n    try:\n        decoded_token = auth.verify_id_token(credentials.credentials)\n        return decoded_token\n    except Exception as e:\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=f\"Invalid authentication credentials: {str(e)}\"\n        )",
    "environment_variables": [
      {
        "name": "GOOGLE_APPLICATION_CREDENTIALS",
        "description": "Path to service account JSON file",
        "required": true,
        "note": "Not needed when deployed on Google Cloud (auto-configured)"
      },
      {
        "name": "FIREBASE_PROJECT_ID",
        "description": "Firebase project ID",
        "required": false
      }
    ]
  },
  "x-oauth-providers": {
    "google": {
      "sign_in_provider": "google.com",
      "scopes": ["email", "profile"],
      "notes": "Google OAuth tokens are verified automatically by Firebase"
    },
    "apple": {
      "sign_in_provider": "apple.com",
      "scopes": ["email", "name"],
      "notes": "Apple Sign-In requires additional setup in Apple Developer Console. Users can choose to hide their email (privaterelay.appleid.com domain)."
    }
  }
}
